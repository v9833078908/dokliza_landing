# Caddyfile for dokliza.com
# Production configuration for VPS deployment

dokliza.com www.dokliza.com {
    # Automatic HTTPS with Let's Encrypt
    # tls {
    #     email your-email@example.com
    # }

    # Root directory for static files
    root * /var/www/dokliza

    # Enable file server
    file_server

    # Security headers (migrated from vercel.json)
    header {
        # Prevent MIME type sniffing
        X-Content-Type-Options nosniff
        
        # Prevent embedding in iframes
        X-Frame-Options DENY
        
        # XSS Protection
        X-XSS-Protection "1; mode=block"
        
        # Cache control for static assets
        Cache-Control "public, max-age=3600"
        
        # Additional security headers
        X-Robots-Tag "index, follow"
        Referrer-Policy "strict-origin-when-cross-origin"
        
        # Remove server information
        -Server
    }

    # Gzip compression
    encode gzip zstd

    # SPA routing - serve index.html for all routes
    try_files {path} /index.html

    # Cache static assets longer
    @static {
        path *.js *.css *.png *.jpg *.jpeg *.gif *.svg *.ico *.woff *.woff2 *.ttf *.otf
    }
    header @static {
        Cache-Control "public, max-age=31536000, immutable"
    }

    # Special handling for documents folder
    @documents {
        path /documents/*
    }
    header @documents {
        Cache-Control "public, max-age=86400"
    }

    # Logging
    log {
        output file /var/log/caddy/dokliza-access.log
        format console
    }

    # Error handling
    handle_errors {
        @404 {
            expression {http.error.status_code} == 404
        }
        rewrite @404 /index.html
        file_server
    }
}

# Redirect HTTP to HTTPS (optional, Caddy handles this automatically)
# But explicit for clarity
http://dokliza.com http://www.dokliza.com {
    redir https://dokliza.com{uri} permanent
}